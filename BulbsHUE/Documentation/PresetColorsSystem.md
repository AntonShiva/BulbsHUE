# Система цветов пресетов BulbsHUE

## Обзор

Система цветов пресетов позволяет назначать и применять наборы цветов к лампам Philips Hue. Каждый пресет может содержать до 5 цветов, которые автоматически распределяются между лампами в комнате согласно продуманной логике.

## Архитектура

### Модели данных

#### `PresetColorEntity`
Основная сущность для управления цветами пресетов:
- `sceneId`: ID связанной сцены
- `colors`: Массив цветов пресета (максимум 5)

#### `PresetColor` 
Отдельный цвет в пресете:
- `hexColor`: Цвет в формате HEX (#RRGGBB)
- `priority`: Приоритет применения (0 - высший)

#### `EnvironmentSceneEntity`
Обновлена для поддержки цветов:
- `presetColors`: Массив цветов пресета

### Сервисы

#### `PresetColorService`
Основной сервис для применения цветов пресетов к лампам:
- Асинхронное применение цветов
- Поддержка разных стратегий распределения
- Интеграция с `LightingColorService`

#### `LightColorStateService` 
Управляет состоянием цветов ламп:
- Сохранение установленных цветов
- Конвертация между форматами
- Получение базового цвета для отображения

## Стратегии распределения цветов

### `ColorDistributionStrategy.adaptive` (Рекомендуемая)
Интеллектуальное распределение в зависимости от количества ламп:

**1 лампа**: Первый (доминирующий) цвет
**2 лампы**: Первые два цвета
**3 лампы**: Первые три цвета из пяти
**4 лампы**: Первые четыре цвета
**5 ламп**: Все пять цветов
**6+ ламп**: Циклическое повторение

### `ColorDistributionStrategy.balanced`
Равномерное распределение по кругу - каждая лампа получает цвет по порядку, с повторением при необходимости.

### `ColorDistributionStrategy.dominantFirst`
Доминирующие цвета назначаются первыми лампам, подходит для создания акцентов.

## Логика назначения цветов (согласно документации Philips Hue)

### Основные принципы:
1. **Приоритетность**: Цвета имеют приоритет (0-4), где 0 - самый важный
2. **Адаптивность**: Система подстраивается под количество доступных ламп
3. **Цветовая гармония**: Цвета подобраны дизайнерами для создания гармоничных сцен
4. **Контекстность**: Учитывается тип помещения и время суток

### Алгоритм распределения:
```swift
// Для комнаты с 3 лампами и 5 цветами пресета:
let distributedColors = ColorDistributionStrategy.adaptive.distributeColors(
    presetColors, 
    forLightCount: 3
)
// Результат: [color[0], color[1], color[2]] - первые три цвета по приоритету
```

## Пресеты первой секции Pastel

### Golden Haze
**Цвета**: `#FCC474`, `#FFB836`, `#E8D1AD`, `#DAA520`, `#DEB887`
**Описание**: Теплые золотистые тона, создают атмосферу утреннего солнца

### Dawn Dunes  
**Цвета**: `#F4A460`, `#D2B48C`, `#C68E17`, `#DEB887`, `#F0E68C`
**Описание**: Песочные оттенки рассвета в пустыне

### Whispering Sands
**Цвета**: `#F5F5DC`, `#CE9158`, `#FFD4A3`, `#FAE7E6`, `#ECBC92`
**Описание**: Мягкие бежевые тона с персиковыми акцентами

### Echoed Patterns
**Цвета**: `#E8875A`, `#CD853F`, `#F4A460`, `#D2691E`, `#ECAA7F`
**Описание**: Насыщенные земляные тона

### Fading Blossoms
**Цвета**: `#FFA07A`, `#FFB6C1`, `#FFDAB9`, `#FFE4E1`, `#FAEBD7`
**Описание**: Нежные розово-персиковые оттенки цветущего сада

### Luminous Drift
**Цвета**: `#E6E6FA`, `#D8BFD8`, `#F0F8FF`, `#B0E0E6`, `#ADD8E6`
**Описание**: Воздушные лавандово-голубые тона

### Skybound Serenity
**Цвета**: `#FFB6C1`, `#FFA07A`, `#FAEBD7`, `#F0CA8C`, `#AAD7F6`
**Описание**: Розово-голубая палитра неба на закате

### Horizon Glow
**Цвета**: `#DB9DCF`, `#F9C1B1`, `#FAEFDD`, `#7E6A98`, `#E2A6A4`
**Описание**: Мягкие фиолетово-розовые тона горизонта

### Ethereal Metropolis
**Цвета**: `#F7D0D4`, `#EE93B1`, `#C77AAB`, `#F872A0`, `#EFAFC9`
**Описание**: Яркие розово-пурпурные оттенки городских огней

### Verdant Mist
**Цвета**: `#D3DFFF`, `#F3BDA2`, `#F9C2E5`, `#FA8C8C`, `#ECC1AF`
**Описание**: Разноцветная палитра утреннего тумана

## Использование в коде

### Применение пресета к комнате:
```swift
let presetColorService = DIContainer.shared.presetColorService

try await presetColorService.applyPresetColors(
    from: scene,
    to: room.lightIds,
    strategy: .adaptive
)
```

### Применение конкретного цвета к лампе:
```swift
try await presetColorService.applyPresetColor(
    from: scene,
    to: lightId,
    colorIndex: 0 // Первый цвет по приоритету
)
```

### Проверка наличия цветов в пресете:
```swift
if scene.hasPresetColors {
    let primaryColor = scene.primaryColor
    let allColors = scene.allColors
}
```

## Визуальные индикаторы

В интерфейсе сцены с пресетными цветами отображают:
- Небольшие цветные точки в углу карточки
- Первые 3 цвета из пресета
- Индикатор "+" если цветов больше 3

## Интеграция с существующими системами

- **NavigationManager**: Определяет целевые лампы/комнаты для применения
- **LightingColorService**: Выполняет фактическое изменение цвета ламп
- **LightColorStateService**: Сохраняет состояние для UI
- **EnvironmentBulbsViewModel**: Автоматически применяет цвета при выборе сцены

## Расширение системы

Для добавления цветов к новым пресетам:
1. Обновите `EnvironmentScenesLocalDataSource.swift`
2. Добавьте массив `presetColors` с 5 цветами
3. Установите приоритеты (0-4) для корректного распределения
